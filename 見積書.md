# 楽天RMS RPPレポートAPI 見積書

**作成日**: 2024年12月（最新更新）  
**プロジェクト名**: 楽天RMS RPPレポート取得API（OAuth2認証対応）  
**対象**: 楽天RMSからRPPレポートのCSVファイルを取得するAPIシステム（OAuth2認証機能付き）

---

## 1. プログラム開発費

### 1.1 開発内容

#### 基本機能
- FastAPIを使用したREST API開発
- Playwrightによるブラウザ自動化実装
- 楽天RMSログイン処理の実装
- RPPレポート取得・ダウンロード処理
- エラーハンドリング・ログ機能
- Docker対応
- 環境変数管理機能
- APIドキュメント整備

#### OAuth2認証機能（追加）
- OAuth2認証モジュールの実装（Client Credentials / Password Credentialsフロー）
- JWTトークン生成・検証機能
- リフレッシュトークン機能
- クライアント認証機能
- ユーザー認証機能（パスワードハッシュ化）
- OAuth2メタデータエンドポイント
- CORS設定
- n8n連携対応
- Postmanテスト対応

### 1.2 コード規模
- **Pythonコード総行数**: 約1,362行（実コード約1,100行）
  - `config.py`: 107行（OAuth設定追加）
  - `main.py`: 400行（OAuth2エンドポイント追加）
  - `rpp_service.py`: 581行（メインロジック）
  - `auth.py`: 276行（OAuth2認証モジュール・新規）
  - `__init__.py`: 2行
- **ドキュメント**: 約1,200行
  - `README.md`: 270行
  - `N8N_SETUP.md`: 198行（新規）
  - `POSTMAN_TEST.md`: 358行（新規）
  - `見積書.md`: 298行
  - その他: 約76行

### 1.3 開発工数

#### 基本機能開発
- **設計・要件定義**: 8時間
- **コーディング**: 40時間
- **テスト・デバッグ**: 16時間
- **Docker対応・ドキュメント**: 8時間
- **小計**: 約72時間

#### OAuth2認証機能開発（追加）
- **設計・要件定義**: 4時間
- **コーディング**: 16時間
- **テスト・デバッグ**: 8時間
- **ドキュメント整備**: 4時間
- **小計**: 約32時間

#### 合計開発工数
- **総工数**: 約104時間

### 1.4 開発費の見積もり

#### オプション1: 一括購入（買い切り）
| 項目 | 金額 |
|------|------|
| 基本開発費（RPPレポート取得機能） | 400,000円 |
| OAuth2認証機能追加 | 200,000円 |
| Docker対応・ドキュメント | 100,000円 |
| **合計（税抜）** | **700,000円** |
| **消費税（10%）** | 70,000円 |
| **合計（税込）** | **770,000円** |

#### オプション2: 月額サブスクリプション
| 項目 | 金額 |
|------|------|
| 初期費用 | 200,000円 |
| 月額利用料 | 40,000円/月 |
| **年間合計** | **680,000円** |

#### オプション3: 開発費 + 保守費
| 項目 | 金額 |
|------|------|
| 開発費（一括） | 600,000円 |
| 保守費（月額） | 25,000円/月 |
| **初年度合計** | **900,000円** |

---

## 2. サーバー設置費

### 2.1 設置作業内容
- サーバー環境の確認（Docker/Docker Composeの有無）
- コードの配置（Git cloneまたはファイル転送）
- Dockerイメージのビルド
- 環境変数（.envファイル）の設定
- docker-compose.ymlの設定確認
- 動作確認・テスト
- 起動・停止方法の説明

### 2.2 作業時間
- **標準作業**: 1〜1.5時間
- **トラブル対応込み**: 2時間

### 2.3 設置費の見積もり

| 項目 | 作業時間 | 金額（税抜） | 金額（税込） |
|------|---------|------------|------------|
| 基本設置作業 | 1〜1.5時間 | 15,000円 | 16,500円 |
| 標準設置作業 | 1.5〜2時間 | 20,000円 | 22,000円 |
| フルサポート | 2時間以上 | 30,000円 | 33,000円 |

**推奨**: 標準設置作業（20,000円）

### 2.4 オプション作業（別途見積もり）

| 項目 | 金額（税抜） | 金額（税込） |
|------|------------|------------|
| リバースプロキシ設定（Nginx等） | 10,000円 | 11,000円 |
| SSL証明書設定 | 5,000円 | 5,500円 |
| 監視設定 | 10,000円 | 11,000円 |
| 自動起動設定（systemd等） | 5,000円 | 5,500円 |

---

## 3. サーバー費用（クライアント負担）

### 3.1 推奨サーバー構成
このAPIはPlaywright（Chromium）を使用するため、以下のリソースが必要です：
- **CPU**: 2コア以上推奨
- **メモリ**: 2GB以上（shm_size: 2gb設定済み）
- **ストレージ**: 10-20GB程度

### 3.2 サーバー費用の目安

#### VPS（仮想専用サーバー）
| サービス | 月額料金 |
|---------|---------|
| さくらのVPS | 1,100円〜 |
| ConoHa VPS | 1,000円〜 |
| KAGOYA VPS | 1,000円〜 |
| **相場** | **1,000円〜2,000円/月** |

#### クラウド（AWS/Azure/GCP）
| サービス | 月額料金 |
|---------|---------|
| AWS EC2 t3.small | 約2,000円 |
| Azure B2s | 約2,000円 |
| **相場** | **2,000円〜5,000円/月** |

**推奨**: VPS（月額 1,500円〜3,000円）

---

## 4. その他の費用

### 4.1 楽天RMS利用料
- **楽天RMS利用料**: 無料（楽天市場出店者向け）
- **楽天API利用料**: 無料（このAPIはブラウザ自動化のためAPI利用料は不要）
- **合計**: **0円**

### 4.2 ドメイン費用（必要に応じて）
- **お名前.com**: 年額 1,000〜3,000円
- **ムームードメイン**: 年額 1,000〜3,000円
- **相場**: 年額 1,000〜3,000円（月額換算 100〜250円）

### 4.3 SSL証明書
- **Let's Encrypt**: 無料
- **商用SSL証明書**: 年額 5,000〜20,000円（通常は不要）

---

## 5. 総額見積もり

### 5.1 ケース1: 一括購入 + 標準設置
| 項目 | 金額（税込） |
|------|------------|
| プログラム開発費（一括） | 770,000円 |
| サーバー設置費（標準） | 22,000円 |
| **合計** | **792,000円** |

**サーバー費用（別途・クライアント負担）**: 月額 1,500円〜3,000円

### 5.2 ケース2: 月額サブスクリプション + 標準設置
| 項目 | 金額（税込） |
|------|------------|
| 初期費用 | 220,000円 |
| 月額利用料 | 44,000円/月 |
| サーバー設置費（標準） | 22,000円 |
| **初回費用** | **242,000円** |
| **年間合計** | **748,000円** |

**サーバー費用（別途・クライアント負担）**: 月額 1,500円〜3,000円

### 5.3 ケース3: 開発費 + 保守費 + 標準設置
| 項目 | 金額（税込） |
|------|------------|
| 開発費（一括） | 660,000円 |
| 保守費（月額） | 27,500円/月 |
| サーバー設置費（標準） | 22,000円 |
| **初回費用** | **682,000円** |
| **初年度合計** | **1,012,000円** |

**サーバー費用（別途・クライアント負担）**: 月額 1,500円〜3,000円

---

## 6. 価格設定の根拠

### 6.1 プログラム開発費
- **コード規模**: 約1,362行（実コード約1,100行）
- **開発工数**: 約104時間（基本機能72時間 + OAuth2機能32時間）
- **技術的難易度**: 高（Playwright自動化、楽天RMSログイン処理、OAuth2認証実装）
- **市場価値**: 高（楽天RMSレポート取得の需要、n8n連携対応により拡大）

### 6.2 サーバー設置費
- **作業時間**: 1〜2時間
- **作業内容**: Docker対応済みのため比較的シンプル
- **リスク**: 低（手順が明確）

### 6.3 価格設定のポイント
1. **技術的難易度**: ブラウザ自動化は高難易度だが、コード量は中規模
2. **市場価値**: 楽天RMSレポート取得の需要はある
3. **作業効率**: Docker対応済みで設置が容易
4. **継続性**: 保守・サポートの有無で価格を調整

---

## 7. 支払い条件

### 7.1 一括購入の場合
- **契約時**: 50%（385,000円）
- **納品時**: 50%（385,000円）
- **設置費**: 設置完了後（22,000円）

### 7.2 月額サブスクリプションの場合
- **初期費用**: 契約時（220,000円）
- **月額利用料**: 毎月末日締め、翌月末日払い（44,000円/月）
- **設置費**: 設置完了後（22,000円）

### 7.3 開発費 + 保守費の場合
- **開発費**: 契約時50%（330,000円）、納品時50%（330,000円）
- **保守費**: 毎月末日締め、翌月末日払い（27,500円/月）
- **設置費**: 設置完了後（22,000円）

---

## 8. 納期

### 8.1 プログラム開発
- **開発期間**: 2〜3週間
- **納品物**: ソースコード、Dockerfile、docker-compose.yml、README.md

### 8.2 サーバー設置
- **設置期間**: 設置作業日から1〜2営業日以内
- **作業時間**: 1〜2時間（サーバー環境による）

---

## 9. 保守・サポート

### 9.1 保守内容
- バグ修正
- セキュリティアップデート
- 軽微な機能改善
- 技術サポート（メール・チャット）

### 9.2 保守料金
- **月額**: 20,000円〜30,000円（税込）
- **年間契約**: 10%割引

### 9.3 サポート範囲
- **対応時間**: 平日 9:00〜18:00
- **緊急対応**: 別途見積もり
- **カスタマイズ**: 別途見積もり

---

## 10. 注意事項

1. **楽天RMSの利用規約**: 楽天RMSの利用規約を確認し、自動化が許可されていることを確認してください。
2. **サーバー環境**: サーバーにDockerとDocker Composeがインストールされている必要があります。
3. **メモリ要件**: Playwrightはメモリを多く使用するため、2GB以上のメモリを推奨します。
4. **ネットワーク**: 安定したネットワーク接続が必要です。
5. **認証情報**: 楽天RMSの認証情報は適切に管理してください。

---

## 11. お問い合わせ

見積もりに関するご質問やご相談は、以下までお問い合わせください。

**連絡先**: [お問い合わせ先を記載]

---

**本見積書の有効期限**: 2025年3月31日まで

---

## 12. OAuth2機能追加の詳細

### 12.1 追加機能の概要
- **Client Credentialsフロー**: n8nなどの外部ツールとの連携に対応
- **Password Credentialsフロー**: ユーザー認証によるアクセス制御
- **リフレッシュトークン**: トークンの有効期限延長機能
- **OAuth2メタデータ**: 標準準拠のメタデータエンドポイント
- **CORS対応**: 外部ツールからのアクセスを許可

### 12.2 対応ツール
- **n8n**: Client Credentialsフローで完全対応
- **Postman**: OAuth2認証でテスト可能
- **その他OAuth2対応ツール**: 標準準拠のため広く対応

### 12.3 セキュリティ機能
- JWTトークンによる認証
- パスワードのbcryptハッシュ化
- トークンの有効期限管理
- クライアント認証によるアクセス制御

---

## 付録: 技術仕様

### 使用技術
- **言語**: Python 3.11
- **フレームワーク**: FastAPI 0.104.0以上
- **ブラウザ自動化**: Playwright 1.35.0以上
- **認証**: OAuth2 (JWT), python-jose, passlib
- **コンテナ**: Docker, Docker Compose
- **Webサーバー**: Uvicorn

### API仕様
- **認証エンドポイント**: 
  - `POST /token` - OAuth2トークン取得（Client Credentials / Password Credentials）
  - `POST /token/refresh` - リフレッシュトークン
  - `GET /token/info` - トークン情報取得
  - `GET /.well-known/oauth-authorization-server` - OAuth2メタデータ
- **データ取得エンドポイント**: 
  - `GET /rpp-report` - RPPレポート取得（認証必要）
- **パラメータ**: `date` (YYYY-MM-DD形式)
- **レスポンス**: CSVファイル
- **エラーハンドリング**: 400, 401, 404, 500エラー対応

### セキュリティ
- OAuth2認証（JWTトークン）
- パスワードハッシュ化（bcrypt）
- 環境変数による認証情報管理
- .envファイルのGit除外
- Dockerコンテナによる分離
- CORS設定

---

**以上**


